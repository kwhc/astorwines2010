/*!
 * jquery.yoxview
 * jQuery image gallery viewer
 * http://yoxigen.com/yoxview
 *
 * Copyright (c) 2010 Yossi Kolesnicov
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Date: 10th July, 2010
 * Version : 1.95
 */ 
var yoxviewApi; (function(w){var x;w.yoxviewUnload=function(){if(yoxviewApi){yoxviewApi.unload();yoxviewApi=null}};w(window).unload(function(){w.yoxviewUnload()});w.fn.extend({yoxview:function(Q){if(this.length==0)return this;x||(x=typeof _yoxviewPath!="undefined"?_yoxviewPath:Yox.getPath(/(.*)jquery.yoxview.*/i));this.loadLanguage=function(r,R){var S=this;if(yoxviewLanguages[r])Yox.loadDataSource(y,R,S);else{yoxviewLanguages[r]={};w.ajax({url:x+"lang/"+r+".js",async:false,dataType:"json",success:function(J){yoxviewLanguages[r]=J; Yox.loadDataSource(y,R,S)}})}};var y=w.extend({autoHideInfo:true,autoPlay:false,backgroundColor:"#000",backgroundOpacity:0.8,buttonsFadeTime:500,cacheImagesInBackground:true,controlsInitialFadeTime:1500,controlsInitialDisplayTime:1E3,dataFolder:x+"data/",imagesFolder:x+"images/",infoBackColor:"Black",infoBackOpacity:0.5,isRTL:false,lang:"en",langFolder:x+"lang/",loopPlay:true,playDelay:3E3,popupMargin:20,popupResizeTime:600,renderButtons:true,renderMenu:true,showBarsOnOpen:true,showButtonsOnOpen:true, titleAttribute:"title",titleDisplayDuration:2E3},Q);yoxviewApi?this.loadLanguage(y.lang,function(r){yoxviewApi.AddViews(r,y)}):this.loadLanguage(y.lang,function(r){yoxviewApi=new YoxView(r,y)});return this}})})(jQuery);var yoxviewLanguages=[]; function YoxView(w,x){function Q(a){a=d(a).data("yoxview");if(!s||na!=a.viewIndex){s=a.images;j=s.length;na=a.viewIndex;var b=false;if(a.options&&!Yox.compare(c,a.options)){c=a.options;b=true}else if(!a.options&&!Yox.compare(c,oa)){c=oa;b=true}else if(K&&j==1||i&&!K&&j>0)b=true;if(b){if(i){z.remove();A=B=T=F=ba=K=i=undefined;C=t=0}pa()}}}function y(a){var b=a.children("img:first"),e={thumbnailImg:b,thumbnailSrc:b.attr("src")},f=a.attr("href");if(f.match(Yox.imageRegex))d.extend(e,{media:{src:a.attr("href"), title:b.attr(c.titleAttribute),alt:b.attr("alt")}});else for(videoProvider in Aa)if(f.match(Aa[videoProvider])){d.extend(e,{media:{type:"video",provider:videoProvider,url:f}});break}return e}function r(a,b,e){a=d(a);a.data("yoxview",{viewIndex:b});if(!Yox.compare(c,e))a.data("yoxview").options=e;var f=[];(a[0].tagName=="A"?a:a.find("a:has(img)")).each(function(h,m){f.push(y(d(m)))});if(e.images)f=f.concat(e.images);if(e.dataSource)Yox.dataSources[e.dataSource].getImagesData(e,function(h){f=f.concat(h.images); a.data("yoxview").images=f;var m=h.isGroup?[d.extend(h,{media:{title:h.title+" ("+h.images.length+" images)",alt:h.title}})]:h.images;R(a,m,!h.createGroups?null:function(n){var D=d(n.currentTarget).data("yoxview"),qa=d(n.currentTarget);n=qa.data("yoxthumbs");if(D.imagesAreSet)g.openGallery(D.viewIndex);else{qa.css("cursor","wait");var ca=d.extend({},c);if(ca.dataSourceOptions)d.extend(ca.dataSourceOptions,n);else ca.dataSourceOptions=n;Yox.dataSources[c.dataSource].getImagesData(ca,function(La){D.images= La.images;D.imagesAreSet=true;qa.css("cursor","");g.openGallery(D.viewIndex)})}});a.yoxthumbs("thumbnails").each(function(n,D){d(D).data("yoxview",{viewIndex:G.length});G.push(D)});if(!g.firstViewWithImages&&h.images.length>0){g.firstViewWithImages=a;e.cacheImagesInBackground&&g.startCache()}});else{a.data("yoxview").images=f;R(a)}}function R(a,b,e){a.yoxthumbs({images:b,onClick:e||function(f){c.thumbnailsOptions&&c.thumbnailsOptions.onClick?c.thumbnailsOptions.onClick(d(f.currentTarget).data("yoxthumbs").imageIndex, d(f.currentTarget),d(f.liveFired).data("yoxview").viewIndex):g.openGallery(d(f.liveFired||f.currentTarget).data("yoxview").viewIndex,d(f.currentTarget).data("yoxthumbs").imageIndex);return false}})}function S(a){var b=d(G[na]);U=b[0].tagName=="A"?b:b.yoxthumbs("thumbnails").eq(t);if(U.length==0)U=b.yoxthumbs("thumbnails").eq(0);if(b=U.children("img:first")){a&&F&&F.attr("src",b.attr("src"));ra=b.offset();o={width:b.width(),height:b.height(),top:ra.top-d(window).scrollTop(),left:ra.left}}}function J(a){a.stop().fadeIn(c.buttonsFadeTime, function(){d(this).delay(500).fadeOut(c.buttonsFadeTime)})}function Ma(a){d(a).stop().animate({opacity:0.5},c.buttonsFadeTime)}function sa(a,b,e){var f=d("<a>",{href:"#",click:function(){return g.clickBtn(g[b],e)}});d("<span>"+a+"</span>").css("opacity","0").appendTo(f);f.append(H.getSprite("icons",b));return f}function Ba(a,b,e){var f=new Image;f.src=c.imagesFolder+b+".png";e=d("<a>",{css:{background:"url("+f.src+") no-repeat "+b+" center",opacity:"0",outline:"0"},className:"yoxview_ctlBtn",title:e, href:"#",click:function(){this.blur();return g.clickBtn(a,true)}});e.css(b,"0");return e}function pa(){k=yoxviewLanguages[c.lang];z=d("<div>",{id:"yoxview_popupWrap",css:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",display:"none","z-index":"100"}});i=d("<div>",{id:"yoxview"});z.appendTo(d(parent.document.body)).append(i);B=d("<div>",{className:"yoxview_imgPanel",css:{"z-index":"2"}});A=d("<div>",{className:"yoxview_imgPanel",css:{"z-index":"1",display:"none"}});F=d("<img />",{className:"yoxview_fadeImg", css:{display:"block",width:"100%",height:"100%"}});T=d("<img />",{className:"yoxview_fadeImg",css:{display:"block",width:"100%",height:"100%"}});B.data("yoxviewPanel",{image:F}).append(F).appendTo(i);A.data("yoxviewPanel",{image:T});A.append(T).appendTo(i);var a=j==1;if(a&&!s[0].media[c.titleAttribute])c.renderInfo=false;if(c.renderMenu!==false){var b=d("<div>",{className:"yoxview_popupBarPanel yoxview_top"});c.autoHideMenu!==false&&b.mouseenter(function(){g.isOpen&&Ca()}).mouseleave(function(){g.isOpen&& ta()});E=d("<div>",{id:"yoxview_menuPanel",css:{opacity:"0.8","background-position":H.getBackgroundPosition("menu","back")}});var e=sa(k.Help,"help",false),f=sa(k.Slideshow,"play",false);ua=f.children("span");E.append(sa(k.Close,"close",true),e,f);if(a){f.css("display","none");e.css("display","none");E.css({width:58})}E.find("a:last-child").attr("class","last");b.append(E).appendTo(i);E.delegate("a","mouseenter",function(){d(this).stop().animate({top:"8px"},"fast").find("span").stop().animate({opacity:1}, "fast")}).delegate("a","mouseleave",function(){d(this).stop().animate({top:"0"},"fast").find("span").stop().animate({opacity:0},"fast")})}if(c.renderButtons!==false&&!a){K=Ba(g.prev,c.isRTL?"right":"left",k.PrevImage);K.appendTo(i);ba=Ba(g.next,c.isRTL?"left":"right",k.NextImage);ba.appendTo(i)}L=i.find(".yoxview_ctlBtn");da=d("<div>",{id:"yoxview_ajaxLoader",className:"yoxview_notification",css:{display:"none"}});da.append(d("<img>",{src:c.imagesFolder+"popup_ajax_loader.gif",alt:k.Loading,css:{width:32, height:32,"background-image":"url("+c.imagesFolder+"sprites.png)","background-position":H.getBackgroundPosition("notifications","empty")}})).appendTo(i);jQuery.each(["play","pause","first","last"],function(h,m){var n=H.getSprite("notifications",m);n.attr("className","yoxview_notification").css("display","none").appendTo(i);V[m]=n});I=d("<div>",{id:"yoxview_helpPanel",href:"#",title:k.CloseHelp,css:{background:"url("+c.imagesFolder+"help_panel.png) no-repeat center top",direction:k.Direction,opacity:"0"}, click:function(){return g.clickBtn(g.help,false)}});b=document.createElement("h1");b.innerHTML=k.Help.toUpperCase();e=document.createElement("p");e.innerHTML=k.HelpText;f=document.createElement("span");f.id="yoxview_closeHelp";f.innerHTML=k.CloseHelp;I.append(b).append(e).append(f).appendTo(i);if(c.renderInfo!==false){M=d("<div>",{className:"yoxview_popupBarPanel yoxview_bottom"});M.mouseenter(function(){g.isOpen&&!W&&c.autoHideInfo!==false&&ea()}).mouseleave(function(){g.isOpen&&!W&&c.autoHideInfo!== false&&X()});p=d("<div>",{id:"yoxview_infoPanel"});p.append(d("<div>",{id:"yoxview_infoPanelBack",css:{background:c.infoBackColor,opacity:c.infoBackOpacity}}));N=d("<div>",{id:"yoxview_infoPanelContent"});fa=d("<span>",{id:"yoxview_count"});Y=d("<div>",{id:"yoxview_infoText"});if(a){Y.css("margin-left","10px");fa.css("display","none")}N.append(fa);if(c.renderInfoPin!==false){va=H.getSprite("icons",c.autoHideInfo?"pin":"unpin");Da=d("<a>",{className:"yoxviewInfoLink",href:"#",title:c.autoHideInfo? k.PinInfo:k.UnpinInfo,css:{display:"inline"},click:function(h){h.preventDefault();c.autoHideInfo=!c.autoHideInfo;va.css("background-position",H.getBackgroundPosition("icons",c.autoHideInfo?"pin":"unpin"));this.title=c.autoHideInfo?k.PinInfo:k.UnpinInfo}});Da.append(va).appendTo(N)}if(c.linkToOriginalContext!==false){Z=d("<a>",{className:"yoxviewInfoLink",target:"_blank",title:k.OriginalContext});Z.append(H.getSprite("icons","link")).appendTo(N)}N.append(Y);p.append(N).appendTo(M);i.append(M)}Ea=d("<div>", {css:{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",background:c.backgroundColor,"z-index":"1",opacity:c.backgroundOpacity},click:function(){return g.clickBtn(g.close,true)}}).appendTo(z);c.buttonsFadeTime!=0&&L.hover(function(){g.isOpen&&d(this).stop().animate({opacity:0.5},c.buttonsFadeTime)},function(){d(this).stop().animate({opacity:0},c.buttonsFadeTime)})}function v(a){if(a==j)a=0;var b=s[a].media;if(b&&!b.loaded){C=a;if(!b.type||b.type==="image")Fa.src=b.src;else Ga(b,function(){v(C+ 1)})}else{b=a+1;if(b==j)b=0;var e=s[b].media;if(e&&!e.loaded)v(b);else{b=a-1;if(b<0)b=j-1;(e=s[b].media)&&!e.loaded&&v(b)}}}function Ha(){wa=true;da.stop().stopTime().oneTime(c.buttonsFadeTime,function(){d(this).stop().css("opacity","0.6").fadeIn(c.buttonsFadeTime)})}function xa(a,b,e,f,h){i.stop().animate({width:a,height:b,top:e,left:f},c.popupResizeTime,h)}function ga(){if(j!=1){q=true;if(t<j-1)i.oneTime(c.playDelay,"play",function(){g.next()});else c.loopPlay?i.oneTime(c.playDelay,"play",function(){g.select(0, null)}):O()}}function O(){i.stopTime("play");q=false}function Ia(){var a=d(parent.window).width(),b=d(parent.window).height();return{height:b,width:a,usableHeight:b-c.popupMargin*2,usableWidth:a-c.popupMargin*2}}function ea(a){clearTimeout($);var b=Y.outerHeight();if(b<Ja)b=Ja;p.stop().animate({height:b},500,function(){a&&a()})}function X(a){clearTimeout($);p.stop().animate({height:0},500,function(){a&&a()})}function ta(a){clearTimeout(ya);E.stop().animate({top:Na},500,function(){a&&a()})}function Ca(a){clearTimeout(ya); E.stop().animate({top:0},500,function(){a&&a()})}function ha(a){var b,e=!a.type||a.type==="image";e&&W&&p&&M.css("display","block");clearTimeout($);if(B.css("z-index")==1){l=B;b=F;ia=A}else{l=A;b=T;ia=B}l.data("maxSize",{width:a.width,height:a.height});var f=Yox.fitImageSize(a,{width:u.usableWidth,height:u.usableHeight});if(p){var h=a.title||"";if(a.description)h+=h!=""?"<div id='yoxview_infoTextDescription'>"+a.description+"</div>":a.description;Y.html(h);j>1&&fa.html(t+1+"/"+j);if(Z)g.currentImage.link? Z.attr("href",g.currentImage.link).css("display","inline"):Z.css("display","none")}h=l.data("yoxviewPanel");if(e){b.attr({src:a.src,title:a.title,alt:a.alt});L.css({height:"100%",width:"50%",top:"0"});if(l.isMedia){h.media.remove();h.media=undefined;h.image.show();l.isMedia=false}W=false}else{if(h.media)h.media.show();else{h.media=d("<div>",{className:"yoxview_mediaPanel"});h.image.hide();l.append(h.media)}h.media.html(a.html);L.css({width:ja.width,height:ja.height,top:f.height/2-ja.height/2});if(!l.isMedia){h.image.hide(); l.isMedia=true}if(p){c.autoHideInfo!==false&&X();M.css("display","none");W=true}}ka?l.animate({width:f.width,height:f.height},c.popupResizeTime):l.css({width:f.width+"px",height:f.height+"px"});a=Math.round((u.height-f.height)/2);b=Math.round((u.width-f.width)/2);if(wa){wa=false;da.stop().stopTime().fadeOut(c.buttonsFadeTime)}P=true;xa(f.width,f.height,a,b,function(){if(ka){g.isOpen=true;if(c.controlsInitialDisplayTime>0){c.showButtonsOnOpen&&L.animate({opacity:0.5},c.controlsInitialFadeTime,function(){c.buttonsFadeTime!= 0&&d(this).delay(c.controlsInitialDisplayTime).animate({opacity:0},c.controlsInitialFadeTime)});if(c.showBarsOnOpen){Ca(function(){if(c.autoHideMenu!==false)ya=setTimeout(function(){ta()},c.controlsInitialDisplayTime)});p&&ea(function(){if(c.autoHideInfo!==false)$=setTimeout(function(){X()},c.controlsInitialDisplayTime)})}}c.autoPlay&&g.play();c.onOpen&&c.onOpen();if(la){la();la=undefined}ka=false}P=false});l.css({"z-index":"2",opacity:1});ia.css("z-index","1");l.fadeIn(c.popupResizeTime,function(){ia.css("display", "none");p&&ea(function(){if(c.autoHideInfo!==false)$=setTimeout(function(){X()},c.titleDisplayDuration)});if(j>1){t<j-1&&c.cacheImagesInBackground&&v(t+1);q&&ga()}})}function Oa(a,b,e,f,h){jQuery.jsonp({url:Pa[a]||"http://oohembed.com/oohembed/",data:jQuery.extend({url:b,format:"json"},e),dataType:"jsonp",callbackParameter:"callback",success:function(m){var n={title:m.title,width:m.width,height:m.height,type:m.type};if(m.type==="video")n.html=m.html.replace(/<embed /,'<embed wmode="transparent" ').replace(/<param/, '<param name="wmode" value="transparent"><param').replace(/width=\"[\d]+\"/ig,'width="100%"').replace(/height=\"[\d]+\"/ig,'height="100%"');else m.type==="photo"&&jQuery.extend(n,{src:m.url,alt:m.title,type:"image"});f(n)},error:function(m,n){h&&h(m,n)}})}function Ka(a){try{if(!a)throw"Error: Media is unavailable.";if(!a.type||a.type==="image"){if(d.support.opacity)za.src="";za.src=a.src}else a.loaded?ha(g.currentImage.media):Ga(a,function(e){ha(e)},function(e){ma("Error getting data from:<br /><span class='errorUrl'>"+ e.data.url+"</span>")})}catch(b){ma(b)}}function Ga(a,b,e){if(!a.type||a.type!=="image")Oa(a.provider,a.url,c.videoSize,function(f){d.extend(a,f,{loaded:true});b&&b(a)},e)}function ma(a){ha({html:"<span class='yoxview_error'>"+a+"</span>",width:500,height:300,type:"error",title:""})}var g=this,d=jQuery,da,Fa=new Image,fa,L,C=0,t=0,k={},na=0,oa=x,W=false,ka=true,I,$,ya,F,T,s,j=0,p,N,Z,Ja=30,M,Da,va,Y,q=this.isOpen=false,P=false,wa=false,ja={width:100,height:100},Pa={vimeo:"http://vimeo.com/api/oembed.json", myspace:"http://vids.myspace.com/index.cfm?fuseaction=oembed"},Na=-42,E,ba,V=[],la,c=oa,B,A,ua,i,Ea,z,K,aa=false,za=new Image,U,ra,o,G=[],u,Qa={40:"DOWN",35:"END",13:"ENTER",36:"HOME",37:"LEFT",39:"RIGHT",32:"SPACE",38:"UP",72:"h",27:"ESCAPE"},Ra={RIGHT:c.isRTL?"prev":"next",DOWN:"next",UP:"prev",LEFT:c.isRTL?"next":"prev",ENTER:"play",HOME:"first",END:"last",SPACE:"next",h:"help",ESCAPE:"close"},H=new Yox.Sprites({notifications:{width:59,height:59,sprites:["empty","playRTL","play","pause","last", "first"]},icons:{width:18,height:18,sprites:["close","help","play","link","pin","unpin"]},menu:{height:42,sprites:["back"]}},c.imagesFolder+"sprites.png",c.imagesFolder+"empty.gif");this.AddViews=function(a,b){var e=this.firstViewWithImages!=undefined;jQuery.each(a,function(){r(this,G.length,b);G.push(this);if(!g.firstViewWithImages){var f=d(this).data("yoxview").images;if(f&&f.length!=0)g.firstViewWithImages=this}});if(!e&&this.firstViewWithImages){Q(this.firstViewWithImages);pa();b.cacheImagesInBackground&& j!=0&&v(0);e=true}};this.SetImages=function(a){j=a.length};var Aa={youtube:/.*youtube.com\/watch.*(?:v=[^&]+).*/i,vimeo:/vimeo.com\/\d+/i,hulu:/hulu.com\/watch\//i,viddler:/viddler.com\//i,flickr:/.*flickr.com\/.*/i,myspace:/.*vids.myspace.com\/.*/i,qik:/qik.com/i,revision3:/revision3.com/i,dailymotion:/dailymotion.com/i,"5min":/.*5min\.com\/Video/i};this.openGallery=function(a,b,e){if(typeof a=="function"){e=a;a=b=0}else if(typeof b=="function"){e=b;b=0}a=a||0;b=b||0;Q(G[a]);!i&&j!=0&&pa();c.cacheImagesInBackground&& v(b);this.selectImage(b);z.stop().css({opacity:1}).fadeIn("slow",function(){z.css("opacity","")});if(e)la=e;return false};this.selectImage=function(a){g.currentImage=s[a];t=a;S(true);U.blur();B.css({"z-index":"1",width:o.width,height:o.height});A.css({display:"none","z-index":"2"});ka=true;i.css({width:o.width,height:o.height,top:o.top,left:o.left});this.select(a)};this.refresh=function(){(aa=q)&&O();q||Ha();Ka(g.currentImage.media);aa&&ga()};this.select=function(a,b){if(typeof b==="number")b=undefined; if(!P){if(a<0)a=j-1;else if(a==j)a=0;if(!q&&b){var e=b;e.css("opacity")==0&&e.stop().animate({opacity:0},c.buttonsFadeTime,Ma(e))}g.currentImage=s[a];t=a;q||Ha();Ka(g.currentImage.media);c.onSelect&&c.onSelect(a)}};this.prev=function(){this.select(t-1,K);return false};this.next=function(){this.select(t+1,ba);return false};this.first=function(){J(V.first);this.select(0);return false};this.last=function(){J(V.last);this.select(j-1);return false};this.play=function(){if(j!=1)if(q){J(V.pause);O();ua.text(k.Play)}else{J(V.play); ga();ua.text(k.Pause)}};this.close=function(){this.closeHelp();S(false);xa(o.width,o.height,o.top,o.left,function(){this.isOpen=false});ta();p&&X();l.animate({width:o.width,height:o.height},c.popupResizeTime,function(){l.css("opacity",1);Ea.css("opacity",c.backgroundOpacity)});z.stop().fadeOut(1E3);q&&O();c.onClose&&c.onClose();P=false};this.help=function(){if(this.isOpen)I.css("display")=="none"?I.css("display","block").stop().animate({opacity:0.8},c.buttonsFadeTime):this.closeHelp()};this.closeHelp= function(){I.css("display")!="none"&&I.stop().animate({opacity:0},c.buttonsFadeTime,function(){I.css("display","none")})};this.clickBtn=function(a,b){b&&q&&O();a.call(this);return false};this.AddViews(w,c);d(document).delegate("*","keydown",function(a){if(g&&g.isOpen){var b=g[Ra[Qa[a.keyCode]]];if(b){a.preventDefault();b.apply(g)}}});d(window).bind("resize.yoxview",function(){u=Ia();g.isOpen&&g.resize()});d(Fa).load(function(){d.extend(s[C].media,{width:this.width,height:this.height,loaded:true}); C<j&&v(C+1)}).error(function(){C<j&&v(C+1)});this.startCache=function(){Q(this.firstViewWithImages);v(0)};var l=B,ia=A;u=Ia();this.resize=function(){if(q){aa=true;O()}var a=l.data("maxSize");if(a&&a){a=Yox.fitImageSize(a,{width:u.usableWidth,height:u.usableHeight});l.css({width:"100%",height:"100%"});var b=Math.round((u.height-a.height)/2),e=Math.round((u.width-a.width)/2);P=true;l.isMedia&&L.animate({top:a.height/2-ja.height/2},c.popupResizeTime);xa(a.width,a.height,b,e,function(){var f=i.width(), h=i.height();l.css({width:f+"px",height:h+"px"});P=false;p&&ea();if(aa){ga();aa=false}})}};d(za).load(function(){this.width==0?ma("Image error"):ha(d.extend({},g.currentImage.media,{width:this.width,height:this.height}))}).error(function(){ma("Image not found:<br /><span class='errorUrl'>"+this.src+"</span>")});this.unload=function(){jQuery.each(G,function(a,b){d(b).undelegate("a","click.yoxview").removeData("yoxview").yoxthumbs("unload","yoxview")});d(window).unbind(".yoxview");if(i){z.remove(); i=undefined}}};